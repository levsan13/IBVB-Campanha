<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador PIX (QR + Copia e Cola)</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  :root{
    --bg:#0f172a;
    --card:#0b1220;
    --accent:#06b6d4;
    --muted:#94a3b8;
    --text:#e6eef6;
  }
  body{margin:0;font-family:system-ui,Roboto;background:linear-gradient(180deg,#071026 0%, #0b1220 100%);color:var(--text);}
  .container{max-width:480px;margin:auto;padding:16px;}
  header h1{font-size:18px;margin:0;}
  .card{background:rgba(255,255,255,0.02);border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6);margin-top:12px;}
  label{font-size:13px;color:var(--muted);margin-top:10px;display:block;}
  input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:var(--text);font-size:15px;box-sizing:border-box;}
  .btn{width:100%;margin-top:14px;padding:12px;border-radius:10px;border:0;background:var(--accent);color:#042024;font-weight:600;font-size:15px;}
  .qr-wrap{margin-top:14px;text-align:center;}
  canvas{background:white;padding:8px;border-radius:8px;}
  .code-box{margin-top:12px;background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;font-family:monospace;font-size:13px;word-break:break-all;}
  .actions{display:flex;gap:8px;margin-top:8px;}
  .action-btn{flex:1;padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.08);color:var(--text);}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Gerador PIX — QR & Copia e Cola</h1>
    <div style="font-size:12px;color:var(--muted)">
      Chave: <strong>meuemail@dominio.com</strong> · Banco: <strong>Banco de Tal</strong> · Titular: <strong>Fulano de Tal</strong>
    </div>
  </header>

  <div class="card">
    <label for="amount">Valor (R$)</label>
    <input id="amount" type="number" step="0.01" placeholder="Ex.: 50.00">

    <label for="desc">Descrição (opcional)</label>
    <input id="desc" type="text" maxlength="25" placeholder="Ex.: Doação, Produto X">

    <label for="txid">TXID (opcional)</label>
    <input id="txid" type="text" maxlength="25" placeholder="Ex.: PEDIDO123">

    <button id="generate" class="btn">Gerar QR e Copia & Cola</button>

    <div id="result" style="display:none;">
      <div class="qr-wrap">
        <canvas id="qrcanvas"></canvas>
        <div style="font-size:12px;color:var(--muted);margin-top:6px;">Aponte a câmera do app bancário ou copie o código abaixo.</div>
      </div>
      <div class="code-box" id="pixcode"></div>
      <div class="actions">
        <button id="copyCode" class="action-btn">Copiar código</button>
        <button id="downloadQR" class="action-btn">Baixar QR</button>
      </div>
    </div>
  </div>
</div>

<script>
const PIX_KEY = "meuemail@dominio.com";
const MERCHANT_NAME = "Fulano de Tal";
const MERCHANT_CITY = "FORTALEZA"; // alterado
// função de montagem das tags
function buildTag(id, value){
  const v = String(value);
  const len = String(v.length).padStart(2,'0');
  return id + len + v;
}
// CRC16 (PIX)
function crc16(payload){
  let crc = 0xFFFF;
  for(let i=0;i<payload.length;i++){
    crc ^= payload.charCodeAt(i) << 8;
    for(let j=0;j<8;j++){
      crc = (crc & 0x8000) ? ((crc << 1) ^ 0x1021) : (crc << 1);
      crc &= 0xFFFF;
    }
  }
  return crc.toString(16).toUpperCase().padStart(4,'0');
}
// Payload builder
function buildPixPayload(amount, desc, txid){
  const gui = buildTag("00","br.gov.bcb.pix");
  const key = buildTag("01", PIX_KEY);
  const descTag = desc ? buildTag("02", desc) : "";
  const mai = gui + key + descTag;
  const maiTag = buildTag("26", mai);

  const mcc = buildTag("52","0000");
  const currency = buildTag("53","986");
  const amountTag = amount ? buildTag("54", Number(amount).toFixed(2)) : "";
  const country = buildTag("58","BR");
  const name = buildTag("59", MERCHANT_NAME.slice(0,25));
  const city = buildTag("60", MERCHANT_CITY.slice(0,15));
  const addData = buildTag("05", txid || "*");
  const addTag = buildTag("62", addData);

  const base = buildTag("00","01") + maiTag + mcc + currency + amountTag + country + name + city + addTag + "6304";
  return base + crc16(base);
}

// elementos
const btn = document.getElementById("generate");
const amountEl = document.getElementById("amount");
const descEl = document.getElementById("desc");
const txidEl = document.getElementById("txid");
const resultBox = document.getElementById("result");
const pixCodeDiv = document.getElementById("pixcode");
const copyBtn = document.getElementById("copyCode");
const downloadBtn = document.getElementById("downloadQR");
const canvas = document.getElementById("qrcanvas");

btn.addEventListener("click", async ()=>{
  const amount = amountEl.value ? Number(amountEl.value).toFixed(2) : null;
  const desc = descEl.value.trim() || null;
  const txid = txidEl.value.trim() || null;
  const payload = buildPixPayload(amount, desc, txid);

  pixCodeDiv.textContent = payload;
  resultBox.style.display = "block";

  await QRCode.toCanvas(canvas, payload, {width:260, margin:1});
});
copyBtn.addEventListener("click", async ()=>{
  await navigator.clipboard.writeText(pixCodeDiv.textContent);
  copyBtn.textContent = "Copiado!";
  setTimeout(()=> copyBtn.textContent="Copiar código",1200);
});
downloadBtn.addEventListener("click", ()=>{
  const link = document.createElement("a");
  link.download="pix_qr.png";
  link.href=canvas.toDataURL("image/png");
  link.click();
});
</script>
</body>
</html>
